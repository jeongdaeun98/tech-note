## acks

- 프로듀서가 메세지를 전송했을 때, 리더 파티션과 팔로워 파티션이 레코드를 정상 저장 후 보내는 정보

### 목적

프로듀서가 전송한 데이터가 카프카 클러스터에 얼마나 신뢰성 높게 저장되는지 지정하기 위함

- 복제 개수가 1인 경우 acks 옵션에 따른 성능 변화는 크지 않다.
- 그러나 복제 개수가 2 이상인 경우에 각 acks 별 동작 방식에 대해 알아본다.

성능을 높이고 신뢰성을 낮추거나 성능을 낮추고 신뢰성을 높이는 방식을 선택해야 함.

신뢰도 1,2,3  전송 속도 1,2,3이라 가정하면,

### 신뢰도 1, 전송 속도 3 : acks 0

- 프로듀서가 리더 파티션으로 데이터를 전송했을 때, 메시지 저장을 확인하지 않는다.
- acks를 1 이나 all로 했을 때보다 훨씬 빠르다.
- 데이터 일부 유실이 발생하더라도 전송 속도가 중요한 경우 이 옵션 값을 사용한다.
    - GPS 데이터 저장
- 이 경우 평소에는 메시지를 잘 받다가 브로커가 다운 되는 장애가 일어날 때 손실 가능성이 매우 높다.

### 신뢰도 2 , 전송 속도 2: acks 1

- 프로듀서가 보낸 데이터가 leader파티션에 제대로 적재되었을 경우 ack를 전송한다.
- 리더 파티션에 정상적으로 적재되지 않았을 경우 적재될 때까지 재시도 가능
- follower 파티션에 leader 메시지를 가져오기 전에 리더 파티션이 위치한 브로커에 장애가 발생할 경우 메시지 손실할 가능성이 있다.
    - 그러나 일반적으로 이럴일 잘 없으므로 1

### 신뢰도 3, 전송 속도 1 : acks  -1(all), 브로커의 min.insync.replicas

- 이 경우 프로듀서 데이터 처리량이 너무 낮아서 쓰기 어려움
- 프로듀서는 리더 파티션과 팔로워 파티션에 정상적으로 적재되었는지 확인
- 토픽 단위로 설정 가능한 min.insync.replicas 옵션에 따라 데이터의 안정성이 달라짐.
- min.insync.replicas의 옵션을 2개 이상으로 설정했을 때 all의 의미가 있음.
- 또한 옵션을 2로 설정하더라도, 실제 카프카 클러스터를 운영하며 브로커가 동시에 2개 중단되는 일은 극히 드물기 때문에 리더 파티션과 팔로워 파티션 중 1개 데이터가 적재 완료되었다면 데이터는 유실되지 않는다고 볼 수 있다.

### min.insync.replicas

- 정상 적재에 대한 ack를 보내는 리더 파티션과 팔로워 파티션 개수
- `1 ≤ min.insync.replicas ≤ replication 개수` 로 설정할 수 있음
- replication과 동일하게 설정했을 경우, 브로커가 하나만 다운 되더라도 producer와 consumer와 통신할 수 없는 장애가 나게 된다.
    - 카프카로 메시지를 보낼 수 없는 클러스터 전체 장애와 비슷한 상황이 발생
