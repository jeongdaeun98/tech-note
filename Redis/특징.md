레디스는 싱글 스레드의 이벤트 루프 방식 애플리케이션이다.

따라서 멀티 스레드를 사용하며 발생하는 문맥 교환 비용을 줄일 수 있으며,

스레드 생성 혹은 스레드 소멸로 인한 소비가 없다. 

lock 추가, lock 해제, 교착 상태와 같은 스레드 간 자원 공유로 인한 문제에서 자유롭다.

레디스에 공유 데이터에 lock을 거는 것은 cost-effective한 옵션이 아니다.

멀티 플렉싱이란 기술을 사용하여 단일 프로세스가 모든 클라이언트 요청을 처리한다. 

![Untitled (6)](https://github.com/uneap/tech-note/assets/25525648/6bf03b6d-07fa-4241-9743-aaa0346a482b)

1. Redis는 새로운 클라이언트 연결, 클라이언트에서 들어오는 데이터 또는 I/O 작업 완료와 같은 이벤트가 발생하기를 기다리는 단일 이벤트 루프를 사용
2. 새 클라이언트가 Redis에 연결되면 이벤트 루프에 등록되고 이벤트 루프는 들어오는 데이터에 대한 연결을 모니터링함.
3. 클라이언트로부터 데이터가 도착하면 이벤트 루프는 이벤트 유형을 결정하고 그에 따라 처리
4. 클라이언트의 요청에 I/O작업이 필요한 경우 이벤트 루프는 다른 클라이언트의 연결의 진행을 차단하지 않고 작업을 비동기적으로 수행
5. 이벤트 루프가 여러 클라이언트의 이벤트를 처리할 때 각 클라이언트에 대해 보류 중인 작업 대기열을 유지 관리
    1. 이를 통해 Redis는 실제 처리가 단일 스레드 내에서 발생하더라도 동시에 여러 클라이언트에 서비스를 제공할 수 있음

redis는 NoSQL로 분류되기도, 인메모리로 분류되기도 한다.

| 기능 | Redis | Memcached |
| --- | --- | --- |
| 속도 | 초당 100,000QPS 이상 | 초당 100,000QPS 이상 |
| 자료구조 | Key-Value,List, Hash, Set, Sorted Set | Key-Value |
| 안정성 | 특성을 잘못 이해할 경우 프로세스 장애 발생 | 장애 거의 없음 |
| 응답 속도의 균일성 | 균일성이 떨어질 수 있음 | 전체적으로 균일 |

redis는 global cache 방식을 채택했다.

## 사용자가 많은 트래픽에 적합한 Redis

네트워크 트래픽 발생으로 로컬 캐시보단 성능이 떨어진다.

그렇지만 사용자 증가로 인해 WAS 인스턴스가 더 붙는 경우를 가정했을 때 로컬캐시이고, 같은 데이터가 서버 곳곳에 존재한다고 가정하면,  메모리 사용량이 그만큼 늘어나므로 효율성이 없다.

 샤딩으로 분산 저장하면 네트워크 트래픽으로 인한 지연이 있겠지만 메모리 효율을 높일 수 있다. 

또한 한 서버가 CPU 사용량 증가 및 메모리 용량 부족으로 서버가 다운되는 상황에 대한 대비를 위해, 데이터 복제가 이뤄지는데, 복제차원에서 모든 서버에 같은 데이터를 넣었다 하더라도 직접 조회되지 않으나 메모리에서 차지하고 있다면 비효율적.

그러나 redis에서 마스터 서버와 slave 서버를 설정해두고, 마스터 서버는 쓰기 작업을, 슬레이브는 마스터 서버의 복제 작업을 한다. 마스터 서버가 3개가 있다하면, 데이터는 3개 중 하나에 쓰여지고, 슬레이브는 이 서버를 복제하는 방식으로 하면, 데이터를 효율적으로 활용될 수 있다.

따라서 이런 이유로 redis는 다수의 트래픽이 집중 발생하는 사용자가 많은 환경에 적합하다.

## Data 저장

데이터는 메모리에 write read가 일어나지만, server가 다운되는 상황에 데이터 저장을 보장하기 위해서 disk를 persistence store로 사용한다.

- set
    - 교집합, 합집합, 차이를 매우 빠른 시간 내에 추출할 수 있음.
- sorted set
- set에 score라는 필드가 추가된 데이터 형, 오름차순으로 내부 정렬
- score 값 범위에 따른 쿼리, top rank에 따른 쿼리 등이 가능
- hashes
- list
    - 양방향 linked list
    - list의 앞과 뒤에 데이터를 넣거나 뺄 수 있음.
    - 지정된 index 값을 이용하여 지정된 위치에 데이터를 넣거나 뺄 수 있음.
